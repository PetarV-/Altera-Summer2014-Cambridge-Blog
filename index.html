<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Altera-Summer2014-Cambridge by PetarV-</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header class="without-description">
        <h1>Altera-Summer2014-Cambridge</h1>
        <p></p>
        <p class="view"><a href="https://github.com/PetarV-/Altera-Summer2014-Cambridge">View the Project on GitHub <small>PetarV-/Altera-Summer2014-Cambridge</small></a></p>
        <ul>
          <li><a href="https://github.com/PetarV-/Altera-Summer2014-Cambridge/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/PetarV-/Altera-Summer2014-Cambridge/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/PetarV-/Altera-Summer2014-Cambridge">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>
<a name="week-3" class="anchor" href="#week-3"><span class="octicon octicon-link"></span></a>Week 3</h3>

<p>Lawrence and I have finally obtained additional SoCKits at the end of week 2, so we were finally able to pursue separate ideas. As such, the blog posts will from now on be split between us.</p>

<p>Lawrence:</p>

<ul>
<li>Conducted a few tests involving getting a Bluespec component to use the DRAMs on the FPGA.</li>
<li>Spent most of the week trying to synthesise BlueVecII (a vector coprocessor) onto the FPGA. It initially couldn't fit, so had to be trimmed down; however, in the end the synthesis still failed due to the way it was configured. This idea might be briefly revisited.</li>
<li>Successfully placed the BERI processor on the FPGA and managed to partially boot FreeBSD on it (waiting on a more suitable build of the kernel for this board).</li>
</ul><p>Petar:</p>

<ul>
<li>Initial goal was to fix the kernel versions problem from last week that prevented us from compiling a correct interrupt-handling kernel module. After lots of reformats, I think we finally have a good custom SD card image, containing a manually-compiled kernel, and a choice of useful tools. A working example of an interrupt processing kernel module has since been built and successfully loaded; our own kernel module built last week currently has some undecipherable errors upon initialisation, we will possibly try to re-write it later.</li>
<li>Main goal for the week was porting an exercise from the Cambridge ECAD practicals (can be accessed from <a href="http://www.cl.cam.ac.uk/teaching/1314/ECAD+Arch/labs/lab2/lablet2_2_1.html">this link</a>) to the SoCKit, using the ARM as a substitute for the NIOS and (for now) the on-board LCD instead of the tPad's touchscreen. This involved reading through and understanding Altera's FIFO utilities and libraries for handling the ring processor for the TTCs (both written originally for the NIOS, in C) and rewriting them to be suited for the ARM. In addition I familiarised myself with the API for the LCD. The exercise was successfully ported.</li>
<li>For next week, the main plan is to interface to PixelStream, a Bluespec component that could be used to communicate to VGA devices.</li>
</ul><hr><h3>
<a name="week-2" class="anchor" href="#week-2"><span class="octicon octicon-link"></span></a>Week 2</h3>

<p>During the second week of our internship, we have:</p>

<ul>
<li>Successfully achieved communication FPGA -&gt; ARM, through directly writing to the ARM's SDRAM.</li>
<li>Extended this to support a logical memory model for the FPGA; more precisely:

<ul>
<li>On the ARM, we implemented memory-mapping page-sized chunks, linked together in a doubly-linked list structure (such that the start of each chunk is filled with information such as size and pointers to the previous and next chunk).</li>
<li>From the FPGA side, we have designed a custom component in Bluespec to handle memory address translation. It consists of:

<ul>
<li>An Avalon slave connected to the hps2fpga bridge, receiving the address of the first page in the list from the ARM.</li>
<li>Another Avalon slave which can be linked to any component's master, receiving a request to write at a particular logical address (word-indexed from 0); this request is then translated into the actual address(es) on the ARM and sent to</li>
<li>An Avalon master connected to the fpga2hps bridge, writing directly into the relevant page(s) in the linked list structure on the ARM's SDRAM.</li>
</ul>
</li>
</ul>
</li>
<li>This is currently all implemented using polling, we're currently trying to get interrupts to work properly. We wrote a kernel module for the ARM that receives interrupts, and additional C code that processes them (by reading from a "file" provided by the module). However we didn't get it to work yet, probably due to different versions of the Linux kernel we have on the board and what was used to compile the module.</li>
<li>We also obtained additional SoCKit boards, which should help speed up development and give us a wider range of things to look at.</li>
</ul><hr><h3>
<a name="week-1" class="anchor" href="#week-1"><span class="octicon octicon-link"></span></a>Week 1</h3>

<p>During the first week of our internship, we have:</p>

<ul>
<li>Attended Altera's training session in High Wycombe;</li>
<li>Learnt the basics of Bluespec SystemVerilog and used it to program several example modules;</li>
<li>Got all of Quartus' tools to work by locating missing libraries, fixing rules for USB device permissions, etc;</li>
<li>Booted the ARM processor on the SoCKit using an SD card containing Linux;</li>
<li>Interfaced to the ARM in two ways: initially using Minicom over a USB connection, now also via Ethernet+SSH to ease file transfer.</li>
<li>Successfully programmed the FPGA using the ARM (on-boot) as well as JTAG.</li>
<li>Established basic communication ARM -&gt; FPGA, in the following manner:

<ul>
<li>Wrote a simple BSV module implementing an Avalon Slave that takes a number and returns it tripled;</li>
<li>Connected the module to an 'HPS' component in Qsys and programmed the full design to the FPGA (using the ARM);</li>
<li>Wrote a C program that writes integers to a memory-mapped hps2fpga bridge;</li>
<li>Successfully ran the C program on the ARM chip, getting tripled values back from the FPGA.</li>
</ul>
</li>
</ul><p>For the following week, we hope to:</p>

<ul>
<li>Achieve communication FPGA -&gt; ARM (hopefully directly accessing SDRAM, maybe peripherals?);</li>
<li>Obtain a second SoC board.</li>
<li>Decide on a project.</li>
</ul><hr><p>Lawrence and Petar</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/PetarV-">PetarV-</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>